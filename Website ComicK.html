<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ManhwaLax</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Segoe UI',Arial,sans-serif;background:#121212;color:#eee;}
header{background:#1f1f1f;padding:25px;text-align:center;font-size:28px;font-weight:bold;letter-spacing:1px;box-shadow:0 2px 5px rgba(0,0,0,0.5);}
nav{display:flex;justify-content:center;align-items:center;flex-wrap:wrap;background:#1b1b1b;padding:10px 0;gap:10px;}
nav a{color:#eee;padding:10px 20px;text-decoration:none;font-weight:bold;border-radius:5px;transition:0.2s;cursor:pointer;}
nav a:hover{background:#333;}
nav input{padding:8px;border-radius:5px;border:none;outline:none;width:180px;background:#2a2a2a;color:#eee;}
.hero{text-align:center;padding:50px 20px;background:linear-gradient(90deg,#2c2c2c,#1b1b1b);margin-bottom:20px;}
.hero h1{font-size:36px;margin-bottom:10px;}
.hero p{font-size:18px;color:#bbb;}
.comic-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:20px;padding:20px;}
.comic{background:#1b1b1b;border-radius:10px;overflow:hidden;text-align:center;cursor:pointer;transition:transform 0.3s,box-shadow 0.3s;position:relative;}
.comic:hover{transform:scale(1.05);box-shadow:0 8px 20px rgba(0,0,0,0.7);}
.comic img{width:100%;height:220px;object-fit:cover;display:block;}
.comic h3{margin:12px 0;font-size:16px;padding:0 5px;}
.favorite{position:absolute;top:10px;right:10px;font-size:20px;color:#ff4081;cursor:pointer;}
.favorite:hover{color:#ff79a8;}
#reader{display:none;padding:20px;}
#reader img{width:100%;border-radius:10px;margin-bottom:10px;}
#backReader{color:#eee;text-decoration:none;display:block;text-align:center;margin:20px;cursor:pointer;}
#backReader:hover{text-decoration:underline;}
#chapterList{margin-bottom:20px;}
#chapterList button{padding:10px 15px;margin:5px;background:#2a2a2a;color:#eee;border:none;border-radius:6px;cursor:pointer;}
#chapterList button:hover{background:#444;}
.likeBtn{padding:5px 10px;background:#333;color:#eee;border:none;border-radius:5px;cursor:pointer;margin-right:10px;}
.likeBtn:hover{background:#555;}
#comments{margin-top:20px;}
#comments input{padding:8px;width:70%;border-radius:5px;border:none;margin-right:5px;background:#2a2a2a;color:#eee;}
#comments button{padding:8px 10px;border:none;border-radius:5px;background:#333;color:#eee;cursor:pointer;}
#comments button:hover{background:#555;}
.comment{margin-top:5px;padding:5px;background:#1b1b1b;border-radius:5px;}
#upload{margin-top:20px;display:none;}
#upload input[type=text], #upload input[type=file]{width:60%;padding:6px;border-radius:5px;border:none;background:#2a2a2a;color:#eee;margin-right:5px;}
#upload button{padding:6px 10px;background:#333;border:none;border-radius:5px;color:#eee;cursor:pointer;}
#upload button:hover{background:#555;}
#manageUploaders{display:none;margin-top:20px;background:#1b1b1b;padding:15px;border-radius:8px;}
#manageUploaders h3{margin-bottom:10px;}
#manageUploaders button{margin:3px;padding:5px 8px;border:none;border-radius:5px;background:#333;color:#eee;cursor:pointer;}
#manageUploaders button:hover{background:#555;}
#login{display:none;display:flex;justify-content:center;align-items:center;height:calc(100vh - 100px);}
.login-box{background:#1f1f1f;padding:40px;border-radius:12px;width:320px;box-shadow:0 8px 20px rgba(0,0,0,0.5);}
.login-box input{width:100%;padding:12px;margin:10px 0;border:none;border-radius:6px;background:#2a2a2a;color:#eee;}
.login-box button{width:100%;padding:12px;margin-top:10px;background:#333;color:#eee;border:none;border-radius:6px;cursor:pointer;font-weight:bold;}
.login-box button:hover{background:#555;}
.login-box h2{text-align:center;margin-bottom:20px;}
.login-box p{text-align:center;margin-top:10px;color:red;}
</style>
</head>
<body>

<header>📚 ManhwaLax</header>

<nav>
  <a onclick="showSection('home')">Home</a>
  <a onclick="showSection('reader')">Reader</a>
  <a onclick="showSection('login')">Login</a>
  <input type="text" id="searchInput" placeholder="Search comics...">
</nav>

<div id="home">
  <div class="hero">
    <h1>New</h1>
    <p>Thank You For Choosing This Site!!</p>
  </div>
  <div class="comic-grid" id="comicGrid"></div>
</div>

<div id="reader">
  <a id="backReader" onclick="showSection('home')">⬅ Back to Homepage</a>
  <div id="chapterList"></div>
  <div id="readerControls">
    <button class="likeBtn" id="likeBtn">Like 0</button>
  </div>
  <div class="reader" id="readerPages"></div>

  <div id="comments">
    <input type="text" id="commentInput" placeholder="Write a comment...">
    <button onclick="addComment()">Post</button>
    <div id="commentList"></div>
  </div>

  <div id="upload">
    <input type="text" id="newChapterName" placeholder="New chapter name">
    <input type="file" id="uploadImages" multiple accept="image/*">
    <button onclick="uploadChapter()">Upload Chapter</button>
  </div>

  <div id="manageUploaders">
    <h3>Manage Uploaders (Owner Only)</h3>
    <div id="userList"></div>
  </div>
</div>

<div id="login">
  <div class="login-box">
    <h2>Login</h2>
    <input type="text" placeholder="Username" id="username">
    <input type="password" placeholder="Password" id="password">
    <button onclick="login()">Login</button>
    <p id="msg"></p>
  </div>
</div>

<script>
let currentUser=null;
let currentComicIndex=null;
let currentChapterIndex=0;

const USERS = [
  {username:"owner", password:"1234", role:"owner", canUpload:true},
  {username:"uploader1", password:"1111", role:"uploader", canUpload:false},
  {username:"user1", password:"2222", role:"regular", canUpload:false}
];

const comics=[
  {title:"Comic 1", img:"https://via.placeholder.com/160x220",
   chapters:[{name:"Chapter 1", pages:["https://via.placeholder.com/600x800"]}], likes:0, comments:[]},
  {title:"Comic 2", img:"https://via.placeholder.com/160x220",
   chapters:[{name:"Chapter 1", pages:["https://via.placeholder.com/600x800"]}], likes:0, comments:[]}
];

const comicGrid=document.getElementById("comicGrid");
const chapterList=document.getElementById("chapterList");
const readerPages=document.getElementById("readerPages");
const likeBtn=document.getElementById("likeBtn");
const commentList=document.getElementById("commentList");
const searchInput=document.getElementById("searchInput");
const uploadDiv=document.getElementById("upload");
const manageDiv=document.getElementById("manageUploaders");
const userListDiv=document.getElementById("userList");

// Display comics
function displayComics(list){
  comicGrid.innerHTML="";
  list.forEach((comic,index)=>{
    const div=document.createElement("div");
    div.className="comic";
    div.innerHTML=`<span class="favorite" onclick="toggleFavorite(event, ${index})">💖</span>
                   <img src="${comic.img}" alt="${comic.title}"><h3>${comic.title}</h3>`;
    div.onclick=()=>showChapters(index);
    comicGrid.appendChild(div);
  });
}
displayComics(comics);

searchInput.addEventListener("input",()=>{
  const query=searchInput.value.toLowerCase();
  displayComics(comics.filter(c=>c.title.toLowerCase().includes(query)));
});

function toggleFavorite(e,index){
  e.stopPropagation();
  if(!currentUser){ alert("Login first!"); return; }
  const userFavs=JSON.parse(localStorage.getItem(currentUser+"_favorites")||"[]");
  if(userFavs.includes(index)) userFavs.splice(userFavs.indexOf(index),1);
  else userFavs.push(index);
  localStorage.setItem(currentUser+"_favorites",JSON.stringify(userFavs));
  displayComics(comics);
}

function showChapters(index){
  currentComicIndex=index;
  currentChapterIndex=0;
  showSection('reader');
  readerPages.innerHTML="";
  chapterList.innerHTML="";
  comics[index].chapters.forEach((ch,i)=>{
    const btn=document.createElement("button");
    btn.textContent=ch.name;
    btn.onclick=()=>loadChapter(i);
    chapterList.appendChild(btn);
  });
  loadChapter(0);
}

function loadChapter(chIndex){
  currentChapterIndex=chIndex;
  readerPages.innerHTML="";
  const pages=comics[currentComicIndex].chapters[chIndex].pages;
  pages.forEach(p=>{
    const img=document.createElement("img");
    img.src=p;
    readerPages.appendChild(img);
  });
  updateLikeButton();
  loadComments();
  checkUploadAccess();
  renderManageUploaders();
}

likeBtn.onclick=()=>{
  if(!currentUser){ alert("Login first!"); return; }
  comics[currentComicIndex].likes++;
  updateLikeButton();
}
function updateLikeButton(){
  likeBtn.textContent=`Like 💖 ${comics[currentComicIndex].likes}`;
}

function addComment(){
  if(!currentUser){ alert("Login first!"); return; }
  const text=document.getElementById("commentInput").value.trim();
  if(!text) return;
  const ch=comics[currentComicIndex].chapters[currentChapterIndex];
  if(!ch.comments) ch.comments=[];
  ch.comments.push(`${currentUser}: ${text}`);
  document.getElementById("commentInput").value="";
  loadComments();
}
function loadComments(){
  commentList.innerHTML="";
  const ch=comics[currentComicIndex].chapters[currentChapterIndex];
  if(!ch.comments) return;
  ch.comments.forEach(c=>{
    const div=document.createElement("div");
    div.className="comment";
    div.textContent=c;
    commentList.appendChild(div);
  });
}

// Upload chapters
function uploadChapter(){
  if(!currentUser){ alert("Login first!"); return; }
  const userObj=USERS.find(u=>u.username===currentUser);
  if(!userObj.canUpload){ alert("No upload permission!"); return; }
  const name=document.getElementById("newChapterName").value.trim();
  const files=document.getElementById("uploadImages").files;
  if(!name || files.length===0){ alert("Enter chapter name and select images!"); return; }

  const newChapter={name:name,pages:[]};
  let loaded=0;
  Array.from(files).forEach(file=>{
    const reader=new FileReader();
    reader.onload=(e)=>{
      newChapter.pages.push(e.target.result);
      loaded++;
      if(loaded===files.length){
        comics[currentComicIndex].chapters.push(newChapter);
        document.getElementById("newChapterName").value="";
        document.getElementById("uploadImages").value="";
        showChapters(currentComicIndex);
      }
    };
    reader.readAsDataURL(file);
  });
}

function checkUploadAccess(){
  if(!currentUser){ uploadDiv.style.display="none"; return; }
  const userObj=USERS.find(u=>u.username===currentUser);
  uploadDiv.style.display=(userObj.canUpload)?"block":"none";
}

function renderManageUploaders(){
  if(!currentUser || getUserRole(currentUser)!=="owner"){ manageDiv.style.display="none"; return; }
  manageDiv.style.display="block";
  userListDiv.innerHTML="";
  USERS.forEach(u=>{
    if(u.username==="owner") return;
    const btn=document.createElement("button");
    btn.textContent=u.username + (u.canUpload?" ✅":" ❌");
    btn.onclick=()=>{ u.canUpload=!u.canUpload; renderManageUploaders(); checkUploadAccess(); };
    userListDiv.appendChild(btn);
  });
}

function getUserRole(username){
  const u=USERS.find(x=>x.username===username);
  return u?u.role:"regular";
}

// Login
function login(){
  const u=document.getElementById("username").value;
  const p=document.getElementById("password").value;
  const user=USERS.find(x=>x.username===u && x.password===p);
  if(user && (user.role!=="owner" || u==="owner")){ // Only owner login allowed for owner
    currentUser=user.username;
    alert("Login successful! Role: "+user.role);
    showSection('home');
    checkUploadAccess();
    renderManageUploaders();
  } else { document.getElementById("msg").textContent="Invalid credentials!"; }
}

function showSection(sec){
  document.getElementById("home").style.display="none";
  document.getElementById("reader").style.display="none";
  document.getElementById("login").style.display="none";
  document.getElementById(sec).style.display="block";
}

showSection('home');
</script>
</body>
</html>