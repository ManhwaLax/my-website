<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Manhwa/Hua Reader ‚Äì Admin Only Uploader</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* For line-clamp utility without adding plugins */
    .line-clamp-1 { overflow: hidden; display: -webkit-box; -webkit-line-clamp: 1; -webkit-box-orient: vertical; }
    .line-clamp-2 { overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; }
  </style>
</head>
<body class="bg-neutral-50 text-neutral-900">
<div id="root"></div>

<script type="text/babel">
const { useState, useEffect, useMemo, useRef } = React;

/** CONFIG */
const ADMIN_USERNAME = "owner";    // <-- change
const ADMIN_PASSWORD = "admin123"; // <-- change
const LS_KEY = "manhwa_app_v1";

const now = () => new Date().toISOString();
const uid = () => Math.random().toString(36).slice(2) + Date.now().toString(36);

const readLS = () => {
  try { const raw = localStorage.getItem(LS_KEY); return raw ? JSON.parse(raw) : null; }
  catch { return null; }
};
const writeLS = (s) => { try { localStorage.setItem(LS_KEY, JSON.stringify(s)); } catch {} };

/** Seed demo data */
const seedSeries = () => [{
  id: uid(),
  title: "Shadow of the Foxblade",
  author: "J. An",
  tags: ["action","fantasy"],
  cover: "https://images.unsplash.com/photo-1472457897821-70d3819a0e24?w=800&auto=format&fit=crop&q=60",
  description: "A young swordsman hunts demons while uncovering secrets of a lost clan.",
  createdAt: now(),
  likes: 12, dislikes: 1,
  chapters: [
    { id: uid(), number: 1, title: "Whispers in the Bamboo", createdAt: now(),
      images: [
        "https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?w=1200&auto=format&fit=crop&q=60",
        "https://images.unsplash.com/photo-1519681393784-d120267933ba?w=1200&auto=format&fit=crop&q=60",
        "https://images.unsplash.com/photo-1500534314209-a25ddb2bd429?w=1200&auto=format&fit=crop&q=60",
      ],
      comments: [],
    },
    { id: uid(), number: 2, title: "Ash and Snow", createdAt: now(),
      images: [
        "https://images.unsplash.com/photo-1519681393784-d120267933ba?w=1200&auto=format&fit=crop&q=60",
        "https://images.unsplash.com/photo-1500534314209-a25ddb2bd429?w=1200&auto=format&fit=crop&q=60",
      ],
      comments: [],
    },
  ]
},{
  id: uid(),
  title: "Paper Lantern Hearts",
  author: "Mi Rae",
  tags: ["romance","school"],
  cover: "https://images.unsplash.com/photo-1487412720507-e7ab37603c6f?w=800&auto=format&fit=crop&q=60",
  description: "Two classmates swap journals and discover the courage to confess.",
  createdAt: now(),
  likes: 8, dislikes: 0,
  chapters: [
    { id: uid(), number: 1, title: "First Bell", createdAt: now(),
      images: [
        "https://images.unsplash.com/photo-1549880338-65ddcdfd017b?w=1200&auto=format&fit=crop&q=60",
        "https://images.unsplash.com/photo-1541696432-82c6da8ce7bf?w=1200&auto=format&fit=crop&q=60",
      ],
      comments: [],
    },
  ]
}];

const DEFAULT_STATE = {
  users: {}, // username: {username, points, createdAt}
  auth: { username: null, admin: null },
  series: seedSeries(),
  recentReads: {}, // username: [ { seriesId, chapterId, at } ]
};

function App(){
  const [store, setStore] = useState(() => readLS() || DEFAULT_STATE);
  useEffect(() => writeLS(store), [store]);

  const [route, setRoute] = useState({ name: "home" });
  const goHome   = () => setRoute({ name: "home" });
  const goSeries = (id) => setRoute({ name: "series", id });
  const goReader = (seriesId, chapterId) => setRoute({ name: "reader", seriesId, chapterId });
  const goProfile= () => setRoute({ name: "profile" });
  const goAdmin  = () => setRoute({ name: "admin" });

  const currentUser = store.auth.username;

  const ensureUser = (username) => {
    if (!username) return;
    if (!store.users[username]) {
      setStore(s => ({ ...s, users: { ...s.users, [username]: { username, points: 0, createdAt: now() }}}));
    }
  };

  const loginUser = (username) => { if (!username) return; ensureUser(username); setStore(s => ({...s, auth:{...s.auth, username}})); };
  const logoutUser= () => setStore(s => ({...s, auth:{...s.auth, username: null}}));

  const loginAdmin= (username) => setStore(s => ({...s, auth:{...s.auth, admin:{ username }}}));
  const logoutAdmin=() => setStore(s => ({...s, auth:{...s.auth, admin:null}}));

  const getSeries = (id) => store.series.find(s => s.id===id);

  const addSeries = (payload) => {
    setStore(s => ({...s, series: [{...payload, id: uid(), createdAt: now(), likes:0, dislikes:0, chapters:[]}, ...s.series]}));
  };
  const addChapter = (seriesId, payload) => {
    setStore(s => ({
      ...s,
      series: s.series.map(ser => ser.id===seriesId ? {
        ...ser,
        chapters: [...ser.chapters, {...payload, id: uid(), createdAt: now(), comments: []}]
                   .sort((a,b)=>a.number-b.number)
      } : ser)
    }));
  };

  const likeSeries = (seriesId, delta) => {
    setStore(s => ({
      ...s,
      series: s.series.map(ser => ser.id===seriesId ? {
        ...ser,
        likes: ser.likes + (delta>0?1:0),
        dislikes: ser.dislikes + (delta<0?1:0),
      } : ser)
    }));
  };

  const addComment = ({ seriesId, chapterId, user, text, imageDataUrl }) => {
    if (!user) return;
    const newComment = { id: uid(), user, text, image: imageDataUrl||null, likes:0, dislikes:0, createdAt: now() };
    setStore(s => ({
      ...s,
      series: s.series.map(ser => ser.id!==seriesId ? ser : {
        ...ser,
        chapters: ser.chapters.map(ch => ch.id!==chapterId ? ch : { ...ch, comments: [...ch.comments, newComment] })
      })
    }));
  };

  const likeComment = ({ seriesId, chapterId, commentId, delta }) => {
    setStore(s => {
      let author = null;
      const updated = s.series.map(ser => ser.id!==seriesId ? ser : {
        ...ser,
        chapters: ser.chapters.map(ch => ch.id!==chapterId ? ch : {
          ...ch,
          comments: ch.comments.map(cm => {
            if (cm.id!==commentId) return cm;
            if (delta>0) author = cm.user;
            return { ...cm,
              likes: Math.max(0, cm.likes + (delta>0?1:0)),
              dislikes: Math.max(0, cm.dislikes + (delta<0?1:0)),
            };
          })
        })
      });
      const users = { ...s.users };
      if (author) {
        const u = users[author] || { username: author, points: 0, createdAt: now() };
        users[author] = { ...u, points: (u.points||0) + 1 };
      }
      return { ...s, series: updated, users };
    });
  };

  const markRecent = ({ username, seriesId, chapterId }) => {
    if (!username) return;
    setStore(s=>{
      const arr = s.recentReads[username] || [];
      const filtered = arr.filter(r => !(r.seriesId===seriesId && r.chapterId===chapterId));
      const next = [{seriesId, chapterId, at: now()}, ...filtered].slice(0,12);
      return { ...s, recentReads: { ...s.recentReads, [username]: next } };
    });
  };

  return (
    <div className="min-h-screen">
      <Navbar
        onHome={goHome}
        onProfile={goProfile}
        onAdmin={goAdmin}
        currentUser={currentUser}
        onLogin={loginUser}
        onLogout={logoutUser}
        adminUser={store.auth.admin?.username}
      />
      <div className="max-w-6xl mx-auto p-4">
        {route.name==="home"   && <Home store={store} onOpenSeries={goSeries} currentUser={currentUser} recent={store.recentReads[currentUser||""]||[]} />}
        {route.name==="series" && <SeriesPage series={getSeries(route.id)} onOpenReader={(sid,cid)=>goReader(sid,cid)} onLike={(sid)=>likeSeries(sid,+1)} onDislike={(sid)=>likeSeries(sid,-1)} />}
        {route.name==="reader" && <ReaderPage store={store} seriesId={route.seriesId} chapterId={route.chapterId}
                                  onPrev={(sid,cid)=>goReader(sid,cid)} onNext={(sid,cid)=>goReader(sid,cid)}
                                  onHome={goHome} onOpenSeries={goSeries}
                                  onAddComment={addComment} onLikeComment={likeComment}
                                  currentUser={currentUser} onMarkRecent={markRecent} />}
        {route.name==="profile"&& <Profile users={store.users} username={currentUser} recent={store.recentReads[currentUser||""]||[]} series={store.series} />}
        {route.name==="admin"  && <Admin store={store} addSeries={addSeries} addChapter={addChapter} loginAdmin={loginAdmin} />}
      </div>
    </div>
  );
}

function Navbar({ onHome, onProfile, onAdmin, currentUser, onLogin, onLogout, adminUser }){
  const [nameInput, setNameInput] = useState("");
  return (
    <div className="sticky top-0 z-30 bg-white/80 backdrop-blur border-b border-neutral-200">
      <div className="max-w-6xl mx-auto p-3 flex items-center gap-3">
        <button onClick={onHome} className="text-xl font-bold px-3 py-1 rounded-xl hover:bg-neutral-100">Manhwa Reader</button>
        <div className="ml-auto flex items-center gap-2">
          {currentUser ? (
            <>
              <span className="text-sm px-2 py-1 bg-neutral-100 rounded-full">@{currentUser}</span>
              <button onClick={onProfile} className="px-3 py-1 rounded-xl bg-neutral-900 text-white hover:opacity-90">Profile</button>
              <button onClick={onLogout} className="px-3 py-1 rounded-xl border hover:bg-neutral-100">Logout</button>
            </>
          ) : (
            <>
              <input className="px-3 py-1 rounded-xl border" placeholder="Pick a username"
                     value={nameInput} onChange={e=>setNameInput(e.target.value.trim())} />
              <button onClick={()=>onLogin(nameInput || `user${Math.floor(Math.random()*1000)}`)} className="px-3 py-1 rounded-xl bg-neutral-900 text-white hover:opacity-90">Login</button>
            </>
          )}
          <div className="w-px h-5 bg-neutral-300 mx-2" />
          <button onClick={onAdmin} className="px-3 py-1 rounded-xl border hover:bg-neutral-100">{adminUser ? `Admin: ${adminUser}` : "Admin"}</button>
        </div>
      </div>
    </div>
  );
}

function Home({ store, onOpenSeries, currentUser, recent }){
  const [q, setQ] = useState("");
  const filtered = useMemo(()=>{
    const t = q.toLowerCase();
    return store.series.filter(s =>
      s.title.toLowerCase().includes(t) ||
      s.author.toLowerCase().includes(t) ||
      s.tags.join(" ").toLowerCase().includes(t));
  }, [q, store.series]);
  const recommended = [...store.series].sort((a,b)=>new Date(b.createdAt)-new Date(a.createdAt)).slice(0,6);

  return (
    <div className="space-y-8">
      <div className="flex flex-col sm:flex-row gap-3 items-stretch sm:items-center">
        <input value={q} onChange={e=>setQ(e.target.value)} placeholder="Search manhwa/hua (title, author, tags)" className="flex-1 px-4 py-3 rounded-2xl border shadow-sm" />
        <button className="px-4 py-3 rounded-2xl bg-neutral-900 text-white">Search</button>
      </div>

      {currentUser && (
        <section>
          <h2 className="text-lg font-semibold mb-3">Recently Reading</h2>
          {recent.length===0 ? <p className="text-sm text-neutral-600">Nothing yet. Open a chapter to start reading.</p> : (
            <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
              {recent.map(r=>{
                const s = store.series.find(x=>x.id===r.seriesId);
                const ch = s?.chapters.find(c=>c.id===r.chapterId);
                if (!s || !ch) return null;
                return (
                  <div key={s.id+ch.id} className="rounded-2xl border overflow-hidden bg-white hover:shadow">
                    <button onClick={()=>onOpenSeries(s.id)} className="text-left w-full">
                      <img src={s.cover} alt={s.title} className="aspect-[3/4] w-full object-cover" />
                      <div className="p-3">
                        <div className="font-medium line-clamp-1">{s.title}</div>
                        <div className="text-xs text-neutral-600">Chapter {ch.number}: {ch.title}</div>
                      </div>
                    </button>
                  </div>
                );
              })}
            </div>
          )}
        </section>
      )}

      <section>
        <h2 className="text-lg font-semibold mb-3">Recommended</h2>
        <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
          {recommended.map(s => (
            <div key={s.id} className="rounded-2xl border overflow-hidden bg-white hover:shadow">
              <button onClick={()=>onOpenSeries(s.id)} className="text-left w-full">
                <img src={s.cover} alt={s.title} className="aspect-[3/4] w-full object-cover" />
                <div className="p-3 space-y-1">
                  <div className="font-semibold line-clamp-1">{s.title}</div>
                  <div className="text-xs text-neutral-600 line-clamp-1">{s.author} ‚Ä¢ {s.tags.join(", ")}</div>
                  <div className="text-xs">üëç {s.likes} / üëé {s.dislikes}</div>
                </div>
              </button>
            </div>
          ))}
        </div>
      </section>

      <section>
        <h2 className="text-lg font-semibold mb-3">All</h2>
        <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
          {filtered.map(s => (
            <div key={s.id} className="rounded-2xl border overflow-hidden bg-white hover:shadow">
              <button onClick={()=>onOpenSeries(s.id)} className="text-left w-full">
                <img src={s.cover} alt={s.title} className="aspect-[3/4] w-full object-cover" />
                <div className="p-3 space-y-1">
                  <div className="font-semibold line-clamp-1">{s.title}</div>
                  <div className="text-xs text-neutral-600 line-clamp-1">{s.author} ‚Ä¢ {s.tags.join(", ")}</div>
                  <div className="text-xs">üëç {s.likes} / üëé {s.dislikes}</div>
                </div>
              </button>
            </div>
          ))}
        </div>
      </section>
    </div>
  );
}

function SeriesPage({ series, onOpenReader, onLike, onDislike }){
  if (!series) return <div>Not found.</div>;
  return (
    <div className="space-y-6">
      <div className="flex gap-4">
        <img src={series.cover} alt={series.title} className="w-36 h-48 object-cover rounded-xl border" />
        <div className="flex-1">
          <h1 className="text-2xl font-bold">{series.title}</h1>
          <p className="text-sm text-neutral-600">By {series.author}</p>
          <p className="text-sm mt-2">{series.description}</p>
          <div className="flex items-center gap-2 mt-3">
            <span className="text-xs px-2 py-1 bg-neutral-100 rounded-full">{series.tags.join(" ‚Ä¢ ")}</span>
            <button onClick={()=>onLike(series.id)} className="px-3 py-1 rounded-xl border hover:bg-neutral-100">üëç {series.likes}</button>
            <button onClick={()=>onDislike(series.id)} className="px-3 py-1 rounded-xl border hover:bg-neutral-100">üëé {series.dislikes}</button>
          </div>
        </div>
      </div>
      <div>
        <h3 className="font-semibold mb-2">Chapters</h3>
        <div className="flex flex-col gap-2">
          {series.chapters.sort((a,b)=>a.number-b.number).map(ch => (
            <button key={ch.id} onClick={()=>onOpenReader(series.id, ch.id)} className="text-left px-4 py-3 rounded-xl border bg-white hover:shadow flex justify-between">
              <span>Chapter {ch.number}: {ch.title}</span>
              <span className="text-neutral-500 text-sm">{new Date(ch.createdAt).toLocaleDateString()}</span>
            </button>
          ))}
        </div>
      </div>
    </div>
  );
}

function ReaderPage({ store, seriesId, chapterId, onPrev, onNext, onHome, onOpenSeries, onAddComment, onLikeComment, currentUser, onMarkRecent }){
  const series = store.series.find(s=>s.id===seriesId);
  if (!series) return <div>Series not found.</div>;
  const idx = series.chapters.findIndex(c=>c.id===chapterId);
  const ch = series.chapters[idx];
  useEffect(()=>{ onMarkRecent({ username: currentUser, seriesId, chapterId }); }, [seriesId, chapterId]);

  const prev = idx>0 ? series.chapters[idx-1] : null;
  const next = idx<series.chapters.length-1 ? series.chapters[idx+1] : null;

  return (
    <div className="space-y-4">
      <div className="flex gap-2">
        <button onClick={onHome} className="px-3 py-1 rounded-xl border hover:bg-neutral-100">Home</button>
        <button onClick={()=>onOpenSeries(series.id)} className="px-3 py-1 rounded-xl border hover:bg-neutral-100">Series</button>
        <button disabled={!prev} onClick={()=>onPrev(series.id, prev?.id)} className={"px-3 py-1 rounded-xl border " + (prev? "hover:bg-neutral-100":"opacity-50 cursor-not-allowed")}>‚óÄ Prev</button>
        <button disabled={!next} onClick={()=>onNext(series.id, next?.id)} className={"px-3 py-1 rounded-xl border " + (next? "hover:bg-neutral-100":"opacity-50 cursor-not-allowed")}>Next ‚ñ∂</button>
      </div>

      <h2 className="text-xl font-bold">{series.title} ‚Äî Chapter {ch.number}: {ch.title}</h2>

      <div className="space-y-3">
        {ch.images.map((src,i)=>(
          <img key={i} src={src} className="w-full rounded-lg border bg-white" alt={`Page ${i+1}`} />
        ))}
      </div>

      <Comments
        seriesId={series.id}
        chapterId={ch.id}
        comments={ch.comments}
        onAddComment={onAddComment}
        onLikeComment={onLikeComment}
        currentUser={currentUser}
      />
    </div>
  );
}

function Comments({ seriesId, chapterId, comments, onAddComment, onLikeComment, currentUser }){
  const [text, setText] = useState("");
  const [imgData, setImgData] = useState(null);

  const onFile = (f) => {
    if (!f) return setImgData(null);
    const reader = new FileReader();
    reader.onload = e => setImgData(e.target.result);
    reader.readAsDataURL(f);
  };

  const submit = () => {
    if (!currentUser) return alert("Login first to comment.");
    if (!text.trim() && !imgData) return;
    onAddComment({ seriesId, chapterId, user: currentUser, text: text.trim(), imageDataUrl: imgData });
    setText(""); setImgData(null);
  };

  return (
    <div className="mt-6">
      <h3 className="font-semibold mb-2">Comments</h3>
      <div className="p-3 rounded-xl border bg-white space-y-2">
        <textarea value={text} onChange={e=>setText(e.target.value)} placeholder="Write a comment... use @username to tag"
                  className="w-full border rounded-lg p-2" rows="3" />
        <div className="flex items-center gap-2">
          <input type="file" accept="image/*" onChange={e=>onFile(e.target.files[0])} />
          <button onClick={submit} className="ml-auto px-3 py-1 rounded-xl bg-neutral-900 text-white hover:opacity-90">Post</button>
        </div>
        {imgData && <img src={imgData} alt="preview" className="max-h-48 rounded border" />}
      </div>

      <div className="mt-3 space-y-2">
        {comments.slice().reverse().map(c=>(
          <div key={c.id} className="p-3 rounded-xl border bg-white">
            <div className="text-sm text-neutral-600">@{c.user} ‚Ä¢ {new Date(c.createdAt).toLocaleString()}</div>
            <p className="mt-1 whitespace-pre-wrap">{renderWithTags(c.text)}</p>
            {c.image && <img src={c.image} className="mt-2 max-h-64 rounded border" alt="attachment" />}
            <div className="flex items-center gap-2 mt-2">
              <button onClick={()=>onLikeComment({ seriesId, chapterId, commentId: c.id, delta:+1 })} className="px-2 py-1 rounded-lg border hover:bg-neutral-100">üëç {c.likes}</button>
              <button onClick={()=>onLikeComment({ seriesId, chapterId, commentId: c.id, delta:-1 })} className="px-2 py-1 rounded-lg border hover:bg-neutral-100">üëé {c.dislikes}</button>
            </div>
          </div>
        ))}
      </div>
    </div>
  );
}

function renderWithTags(text=""){
  const parts = text.split(/(@[a-zA-Z0-9_]+)/g);
  return parts.map((p,i)=> p.startsWith("@") ? <span key={i} className="text-blue-600">{p}</span> : <span key={i}>{p}</span>);
}

function Profile({ users, username, recent, series }){
  if (!username) return <div className="p-3 rounded-xl border bg-white">Login to view your profile.</div>;
  const me = users[username] || { username, points: 0 };
  return (
    <div className="space-y-6">
      <div className="p-4 rounded-2xl border bg-white">
        <div className="text-xl font-bold">@{me.username}</div>
        <div className="text-sm text-neutral-600">Points: {me.points} (1 point per like on your comments)</div>
      </div>
      <div>
        <h3 className="font-semibold mb-2">Recently Reading</h3>
        {recent.length===0 ? <p className="text-sm text-neutral-600">No recent chapters.</p> : (
          <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
            {recent.map(r=>{
              const s = series.find(x=>x.id===r.seriesId);
              const ch = s?.chapters.find(c=>c.id===r.chapterId);
              if (!s || !ch) return null;
              return (
                <div key={s.id+ch.id} className="rounded-2xl border overflow-hidden bg-white">
                  <img src={s.cover} className="aspect-[3/4] w-full object-cover" />
                  <div className="p-3">
                    <div className="font-medium line-clamp-1">{s.title}</div>
                    <div className="text-xs text-neutral-600">Ch {ch.number}: {ch.title}</div>
                  </div>
                </div>
              );
            })}
          </div>
        )}
      </div>
    </div>
  );
}

function Admin({ store, addSeries, addChapter, loginAdmin }){
  const admin = store.auth.admin;
  const [form, setForm] = useState({ user:"", pass:"" });

  if (!admin) {
    return (
      <div className="max-w-md mx-auto p-4 rounded-2xl border bg-white space-y-3">
        <div className="text-lg font-semibold">Admin Login</div>
        <input value={form.user} onChange={e=>setForm({...form, user:e.target.value})} placeholder="Username" className="w-full border rounded-lg p-2" />
        <input value={form.pass} onChange={e=>setForm({...form, pass:e.target.value})} placeholder="Password" type="password" className="w-full border rounded-lg p-2" />
        <button
          onClick={()=>{
            if (form.user===ADMIN_USERNAME && form.pass===ADMIN_PASSWORD) loginAdmin(form.user);
            else alert("Invalid admin credentials.");
          }}
          className="w-full px-4 py-2 rounded-xl bg-neutral-900 text-white">Login</button>
        <p className="text-xs text-neutral-500">Only the site owner can log in.</p>
      </div>
    );
  }

  return (
    <div className="space-y-8">
      <AddSeriesForm onSubmit={addSeries} />
      <AddChapterForm series={store.series} onSubmit={addChapter} />
    </div>
  );
}

function AddSeriesForm({ onSubmit }){
  const [f, setF] = useState({ title:\"\", author:\"\", tags:\"\", cover:\"\", description:\"\" });
  return (
    <div className="p-4 rounded-2xl border bg-white space-y-3">
      <div className="text-lg font-semibold">Add New Series</div>
      <div className="grid sm:grid-cols-2 gap-3">
        <input className="border rounded-lg p-2" placeholder="Title" value={f.title} onChange={e=>setF({...f,title:e.target.value})} />
        <input className="border rounded-lg p-2" placeholder="Author" value={f.author} onChange={e=>setF({...f,author:e.target.value})} />
        <input className="border rounded-lg p-2 sm:col-span-2" placeholder="Tags (comma separated)" value={f.tags} onChange={e=>setF({...f,tags:e.target.value})} />
        <input className="border rounded-lg p-2 sm:col-span-2" placeholder="Cover image URL" value={f.cover} onChange={e=>setF({...f,cover:e.target.value})} />
        <textarea className="border rounded-lg p-2 sm:col-span-2" rows="3" placeholder="Description" value={f.description} onChange={e=>setF({...f,description:e.target.value})}></textarea>
      </div>
      <button
        onClick={()=>{
          if (!f.title || !f.author) return alert("Title and Author are required.");
          onSubmit({ title:f.title, author:f.author, tags:f.tags.split(',').map(s=>s.trim()).filter(Boolean), cover:f.cover||'https://picsum.photos/600/800', description:f.description||\"\", });
          setF({ title:\"\", author:\"\", tags:\"\", cover:\"\", description:\"\" });
          alert(\"Series added!\");
        }}
        className="px-4 py-2 rounded-xl bg-neutral-900 text-white">Add Series</button>
    </div>
  );
}

function AddChapterForm({ series, onSubmit }){
  const [seriesId, setSeriesId] = useState(series[0]?.id||\"\");
  const [f, setF] = useState({ number:\"\", title:\"\", images:[] });
  const [imageUrls, setImageUrls] = useState(\"\"); // one per line OR choose files

  const onFiles = (files) => {
    const arr = Array.from(files||[]);
    if (arr.length===0) return;
    // convert to data URLs
    const readers = arr.map(file => new Promise(res=>{ const r=new FileReader(); r.onload=e=>res(e.target.result); r.readAsDataURL(file); }));
    Promise.all(readers).then(urls=>{
      setF(prev=>({ ...prev, images:[...prev.images, ...urls] }));
      alert(\"Added \"+urls.length+\" images\");
    });
  };

  return (
    <div className="p-4 rounded-2xl border bg-white space-y-3">
      <div className="text-lg font-semibold">Add Chapter</div>
      <div className="grid sm:grid-cols-2 gap-3">
        <select className="border rounded-lg p-2" value={seriesId} onChange={e=>setSeriesId(e.target.value)}>
          {series.map(s=> <option key={s.id} value={s.id}>{s.title}</option>)}
        </select>
        <input className="border rounded-lg p-2" placeholder="Chapter number" value={f.number} onChange={e=>setF({...f,number:e.target.value.replace(/[^0-9]/g,'')})} />
        <input className="border rounded-lg p-2 sm:col-span-2" placeholder="Chapter title" value={f.title} onChange={e=>setF({...f,title:e.target.value})} />
        <textarea className="border rounded-lg p-2 sm:col-span-2" rows="3" placeholder="One image URL per line"
                  value={imageUrls} onChange={e=>setImageUrls(e.target.value)}></textarea>
        <div className="sm:col-span-2">
          <label className="text-sm">Or upload images:</label>
          <input type="file" accept="image/*" multiple onChange={e=>onFiles(e.target.files)} />
        </div>
      </div>
      <button
        onClick={()=>{
          const urls = imageUrls.split(/\\n+/).map(s=>s.trim()).filter(Boolean);
          const images = [...f.images, ...urls];
          if (!seriesId || !f.number || images.length===0) return alert(\"Series, number and images required.\");
          onSubmit(seriesId, { number: Number(f.number), title: f.title||(\"Chapter \"+f.number), images });
          setF({ number:\"\", title:\"\", images:[] }); setImageUrls(\"\"); alert(\"Chapter added!\");
        }}
        className="px-4 py-2 rounded-xl bg-neutral-900 text-white">Add Chapter</button>
    </div>
  );
}

const root = ReactDOM.createRoot(document.getElementById("root"));
root.render(<App />);
</script>
</body>
</html>
